# 託麻東少年野球クラブ スケジュール管理システム

## 📋 プロジェクト概要

託麻東少年野球クラブのスケジュール管理と参加状況管理を行うスマートフォンアプリ風のWebアプリケーションです。保護者が選手の参加状況を入力し、管理者が全体の進捗を確認できるシステムです。

## 🎯 主要機能

### 1. スケジュール管理
- **予定一覧表示**: 練習・試合・イベントの一覧表示（アコーディオン形式）
- **予定詳細**: モーダルで詳細情報を表示
- **日付・時間・場所**: 各予定の基本情報管理
- **イベントタイプ**: 練習・練習試合・公式戦・その他
- **ファイル添付**: 大会要項などのPDFファイル添付

### 2. 参加状況管理
- **参加入力**: 保護者が選手の参加状況を入力（アコーディオン形式）
- **家族単位での管理**: きょうだいがいる場合の適切な管理
- **詳細入力項目**:
  - 選手の参加状況（参加/不参加/未定）
  - 保護者の参加人数
  - 車出し（乗車可能人数）
  - 道具車担当（できる/できない）
  - 審判担当（できる/できない）
  - 送迎（できる/できない）
  - コメント
- **練習イベント**: 不参加連絡のみの簡易フォーム（自動的に参加扱い）

### 3. 進捗確認（管理者機能）
- **参加状況サマリー**: 全選手の参加状況を一覧表示
- **モーダル表示**: イベント選択で詳細な参加状況を確認
- **集計情報**: 選手参加率、保護者参加率、車出し、審判担当の統計
- **過去イベント非表示**: 未来のイベントのみ表示
- **ソート機能**: 参加状況による選手の並び替え

### 4. 試合記録管理
- **試合記録表示**: アコーディオン形式で試合記録を一覧表示
- **記録入力**: 管理者が試合結果とスコアを記録
- **ファイルアップロード**: スコアブック写真などのアップロード
- **ユーザー閲覧**: 一般ユーザーも試合記録を閲覧・ファイルアップロード可能
- **UI改善**: シンプルで見やすい表示（アイコン削除、結果表示改善）

### 5. 選手管理（管理者機能）
- **選手登録**: 保護者ごとの選手情報管理
- **選手編集**: 選手名、ひらがな名、学年、ポジションの編集
- **選手削除**: 不要な選手情報の削除
- **学年別フィルタ**: 6年、5年、4年、3年、2年、1年での絞り込み
- **UI改善**: コンパクトで使いやすいインターフェース

### 6. 選手名簿（ユーザー機能）
- **選手一覧表示**: 全選手の名前、学年、ポジションを表示
- **学年別表示**: 学年ごとにグループ化して表示
- **学年色分け**: 各学年を色分けして見やすく
- **ソート機能**: 学年順、名前順での並び替え

### 7. ユーザー管理
- **PIN認証**: 4桁のPINでログイン
- **保護者アカウント**: 選手情報と参加状況入力
- **管理者アカウント**: 全体管理機能
- **Supabase連携**: クラウドデータベースでのデータ管理

### 8. 会計管理システム
- **支出報告**: 保護者が立替金を報告（野球関連費目に特化）
- **立替金状況**: 全員の未払い立替金を透明性高く表示
- **支出管理**: 管理者が支出の承認・却下・支払い管理
- **立替金管理**: 立替金の集計・支払い処理
- **費目管理**: 野球クラブ特有の費目カテゴリ・サブカテゴリ
- **よく使われる費目**: 頻出費目のワンクリック選択
- **レシート画像**: 領収書の画像アップロード・表示

### 9. マイページ
- **選手情報管理**: 選手の追加・編集・削除
- **ひらがな名前**: 選手のひらがな名前を設定
- **保護者情報**: 保護者名とPINの表示・編集

## 🛠️ 技術仕様

### フロントエンド
- **React 18**: UIライブラリ
- **TypeScript**: 型安全性
- **Tailwind CSS**: スタイリング
- **Vite**: ビルドツール
- **Lucide React**: アイコンライブラリ

### データ管理
- **Supabase**: クラウドデータベース（PostgreSQL）
- **LocalStorage**: フォールバック用のローカルストレージ
- **JSON**: データ形式
- **PWA対応**: モバイルアプリ風の体験

### アーキテクチャ
- **コンポーネント設計**: 再利用可能なUIコンポーネント
- **Context API**: 認証状態管理
- **カスタムフック**: ロジックの分離
- **サービス層**: Supabaseとの通信を抽象化

## 📱 ユーザーインターフェース

### スマートフォンアプリ風UI
- **モバイルファーストデザイン**: PCでもスマートフォンサイズで表示
- **固定下部ナビゲーション**: アプリ風のタブナビゲーション
- **アコーディオン形式**: 詳細情報の展開・折りたたみ
- **モーダル表示**: 詳細情報の表示

### 認証
- PIN入力（4桁）
- 管理者/保護者の自動判定
- ログアウト確認ダイアログ

### メインナビゲーション

#### 保護者向け（下部ナビゲーション）
- **予定**: イベント一覧と詳細表示
- **参加入力**: 参加状況入力（アコーディオン形式）
- **試合記録**: 試合記録の閲覧・ファイルアップロード

#### 保護者向け（ハンバーガーメニュー）
- **選手名簿**: 全選手の一覧表示（学年別）
- **会計報告**: 立替金の報告・入力
- **立替金状況**: 全員の未払い立替金確認
- **マイページ**: 選手情報と保護者情報管理

#### 管理者向け（下部ナビゲーション）
- **予定**: イベント一覧と詳細表示
- **進捗確認**: 参加状況確認（モーダル表示）
- **試合記録**: 試合記録の管理・編集

#### 管理者向け（ハンバーガーメニュー）
- **選手管理**: 選手情報の管理
- **イベント管理**: イベントの作成・編集・削除
- **会計管理**: 支出の承認・却下・管理
- **立替金管理**: 立替金の集計・支払い処理

## 🎨 デザインシステム

### カラーパレット
- **プライマリ**: 青系（#3B82F6）
- **セカンダリ**: 緑系（#10B981）
- **アクセント**: オレンジ系（#F59E0B）
- **統一カラー**: 青（できる/参加）、赤（できない/不参加）

### UI要素
- **カード**: 情報のグループ化
- **ボタン**: アクション実行（青：肯定、赤：否定）
- **モーダル**: 詳細情報表示（固定ヘッダー）
- **バッジ**: ステータス表示
- **アコーディオン**: 詳細情報の展開・折りたたみ
- **固定ナビゲーション**: 下部固定のタブナビゲーション

## 📊 データ構造

### 主要エンティティ
- **Event**: イベント情報
- **User**: 保護者情報
- **Player**: 選手情報
- **Participation**: 参加状況
- **Admin**: 管理者情報
- **GameRecord**: 試合記録
- **ExpenseCategory**: 費目カテゴリ
- **ExpenseSubcategory**: 費目サブカテゴリ
- **Expense**: 支出情報
- **QuickExpense**: よく使われる費目

### 参加状況の詳細
```typescript
interface Participation {
  eventId: string;
  playerId: string;
  status: 'attending' | 'not_attending' | 'undecided';
  parentParticipation: 'attending' | 'not_attending' | 'undecided' | string;
  carCapacity?: number;
  equipmentCar?: boolean;
  umpire?: boolean;
  transport?: 'can_transport' | 'cannot_transport';
  comment?: string;
}
```

### 会計管理の詳細
```typescript
interface Expense {
  id: string;
  userId: string;
  expenseDate: string;
  amount: number;
  categoryId: string;
  subcategoryId: string;
  description?: string;
  receiptUrl?: string;
  status: 'pending' | 'approved' | 'rejected' | 'paid';
  rejectionReason?: string;
  approvedBy?: string;
  approvedAt?: string;
  paidAt?: string;
  createdAt: string;
  updatedAt: string;
}

interface ExpenseCategory {
  id: string;
  name: string;
  displayOrder: number;
}

interface QuickExpense {
  id: string;
  categoryId: string;
  subcategoryId: string;
  label: string;
  displayOrder: number;
}
```

## 🚀 開発状況

### ✅ 完了済み
- [x] プロジェクト初期設定
- [x] 認証システム（PIN認証）
- [x] スケジュール表示機能（アコーディオン形式）
- [x] 参加状況入力フォーム（アコーディオン形式）
- [x] マイページ（選手管理・保護者情報管理）
- [x] 進捗確認ページ（モーダル表示）
- [x] 試合記録管理（アコーディオン形式）
- [x] 選手管理（管理者機能）
- [x] ファイル管理機能
- [x] スマートフォンアプリ風UI
- [x] 固定下部ナビゲーション
- [x] アコーディオン形式の詳細表示
- [x] モーダル表示（固定ヘッダー）
- [x] 統一カラーパレット（青：肯定、赤：否定）
- [x] ログアウト確認ダイアログ
- [x] 練習イベントの簡易フォーム
- [x] イベントタイプ管理（練習・練習試合・公式戦・その他）
- [x] 参加状況の詳細入力（道具車・審判・送迎）
- [x] 試合記録のファイルアップロード
- [x] 管理者・一般ユーザーの役割分離
- [x] PWA対応
- [x] Supabase連携（クラウドデータベース）
- [x] 選手名簿機能（学年別表示）
- [x] 学年別フィルタ機能
- [x] 過去イベント非表示機能
- [x] 参加状況ソート機能
- [x] 試合記録UI改善
- [x] エラーメッセージ日本語化
- [x] ログイン画面改善
- [x] フッタータブサイズ調整
- [x] 会計管理システム統合
- [x] ハンバーガーメニュー実装
- [x] 野球クラブ特化費目カテゴリ
- [x] 立替金透明性管理
- [x] レシート画像アップロード

### 📋 今後の改善点
- [ ] データバックアップ機能
- [ ] 通知機能（必要に応じて）
- [ ] 印刷機能
- [ ] データエクスポート機能
- [ ] オフライン対応の強化

### 🚀 将来の機能拡張案

#### 大会・試合管理
- [ ] 大会登録・管理機能
- [ ] 対戦相手情報管理
- [ ] 試合結果予測・分析
- [ ] 複数大会の日程管理

#### 選手育成・評価
- [ ] スキル評価・記録機能
- [ ] 成長記録・上達度管理
- [ ] ポジション適性分析
- [ ] 個人・チーム目標設定

#### 保護者コミュニケーション
- [ ] お知らせ・重要連絡配信
- [ ] アンケート・投票機能
- [ ] 写真共有・アルバム機能
- [ ] チーム内チャット機能

#### 財務管理（一部実装済み）
- [x] 支出管理（道具代・遠征費）
- [x] 立替金管理・記録
- [ ] 会費徴収・管理機能
- [ ] 寄付金管理・記録
- [ ] 年間予算計画・実行

#### 道具・設備管理
- [ ] 道具在庫管理（バット・グローブ等）
- [ ] 道具貸出・返却管理
- [ ] 設備メンテナンス記録
- [ ] 新規購入計画・予算管理

#### コーチ・指導者管理
- [ ] 指導記録・練習内容管理
- [ ] 年間・月間指導計画
- [ ] 個人指導記録・評価
- [ ] コーチ評価・フィードバック

#### 地域連携
- [ ] 他チームとの交流・連携
- [ ] 練習場予約システム
- [ ] 審判派遣・手配管理
- [ ] 地域大会情報共有

#### データ分析・レポート
- [ ] 参加率分析（月別・選手別）
- [ ] 試合結果統計・分析
- [ ] 選手成長曲線・分析
- [ ] 月次・年次レポート生成

#### モバイル機能強化
- [ ] GPS連携（練習場ナビ）
- [ ] 天気予報連動
- [ ] 個人カレンダー同期
- [ ] プッシュ通知機能

#### 多言語対応
- [ ] 英語対応（外国人選手・保護者向け）
- [ ] 中国語対応（中国系保護者向け）
- [ ] 韓国語対応（韓国系保護者向け）

### 💰 有料化・展開戦略

#### 価格プラン
- **ベーシック**: 月1,000円（基本機能）
- **スタンダード**: 月1,500円（+コミュニケーション機能）
- **プレミアム**: 月2,000円（全機能・分析機能）

#### 段階的展開
1. **Phase 1**: 基本機能（現在の機能）
2. **Phase 2**: コミュニケーション機能追加
3. **Phase 3**: 管理機能（財務・道具）追加
4. **Phase 4**: 分析・レポート機能追加

#### 市場規模
- **日本の少年野球クラブ数**: 推定10,000-15,000クラブ
- **潜在市場**: 月1,000万円-1,500万円
- **目標**: 100クラブで月10万円の収益

## 🏃‍♂️ セットアップ

### 必要な環境
- Node.js 18以上
- npm または yarn

### インストール
```bash
npm install
```

### 開発サーバー起動
```bash
npm run dev
```

### ビルド
```bash
npm run build
```

## 📝 使用方法

### 保護者として
1. PIN（例：1001）でログイン
2. マイページで選手情報を設定
3. 参加入力タブで各イベントの参加状況を入力（アコーディオン形式）
4. 予定タブでイベント詳細を確認
5. 試合記録タブで試合結果を閲覧・ファイルアップロード
6. ハンバーガーメニューから会計報告で立替金を報告
7. 立替金状況で全員の未払い立替金を確認

### 管理者として
1. PIN（9999）でログイン
2. 進捗確認タブで全体の参加状況を確認（学年順→ID順ソート）
3. 試合記録タブで試合結果を記録・編集（アコーディオン展開時は青背景）
4. ハンバーガーメニューから選手管理で選手情報を管理（PIN順表示）
5. ハンバーガーメニューからイベント管理でイベントを作成・編集
6. ハンバーガーメニューから会計管理で支出を承認・却下
7. ハンバーガーメニューから立替金管理で支払い処理

## 🔧 設定

### 認証情報
- **管理者PIN**: 9999（緊急時フォールバックあり）
- **保護者PIN**: 1001-1035（実部員35名分）
- Supabaseクラウドデータベースで管理

### カスタマイズ
- `src/data/sampleData.ts`: サンプルデータの編集
- `tailwind.config.js`: デザインシステムのカスタマイズ
- `src/types/index.ts`: データ型の定義

## 📞 サポート

システムに関する質問や問題がございましたら、開発チームまでお問い合わせください。

---

**託麻東少年野球クラブ スケジュール管理システム v3.0**

## 🎉 最新アップデート（v3.0 - 本番運用開始版）

### 選手IDシステムの導入
- **新ID規則**: 学年×1000+連番（例: 6001, 6002...）
- **ソート最適化**: 学年順→ID順で自然な並び
- **実部員データ**: 35名の実選手データ登録完了
- **PIN連番**: 1001-1035で保護者アカウント管理

### UI/UX改善
- **アコーディオン視覚化**: 
  - 開: 青罫線+青背景+青アイコン
  - 閉: グレー罫線+白背景
  - 選手管理・試合記録で統一
- **PWAアイコン**: 余白調整で枠内に収まるように改善
- **フッターマージン**: 下部余白拡大（pb-32）
- **LINE ID保存**: マイページでLINE ID保存の不具合修正

### ソート順の統一
- **参加進捗**: 参加状況順→学年順（降順）→ID順（昇順）
- **参加状況詳細**: PIN順で保護者表示
- **選手名簿**: 学年順→ID順
- **選手管理**: 全て表示時はPIN順、学年フィルター時は学年別

### データ管理の整理
- **モックデータ削除**: サンプルユーザーを空配列に
- **SQLファイル整理**: 32個の古いSQLをarchiveに移動
- **管理者PIN統一**: 9999に統一（Supabase + フォールバック）
- **実データのみ運用**: 本番環境への移行完了

### データベース改善
- **保護者名修正**: 4年生保護者の名前修正SQL追加
- **選手ID更新**: 既存ユーザーのID更新SQL作成
- **外部キー制約**: uploaded_byのNULL許可と参照修正

## 🎉 過去のアップデート（v2.3）

### PWA機能の強化
- **ホーム画面アイコン**: 青色の「託」ロゴをPWAアイコンに設定（192x192、512x512）
- **下部メニュー**: 縦幅を拡大してタップしやすさを向上（py-5、pb-28）
- **アイコンとテキスト**: サイズは最適なバランスで維持

### モーダル表示の改善
- **最小縦幅**: モーダルを60-70vhに設定して一貫した表示サイズに
- **PDF表示**: モーダル内表示を廃止し、別ブラウザタブで開く方式に変更
- **画像表示**: モーダル内で画像を表示、ピンチズーム対応
- **コンテンツ適応**: コンテンツ量に応じた適切なレイアウト調整

### ファイル管理機能の改善
- **Supabase Storage連携**: Base64からストレージ公開URLに変更
- **ファイルアップロード**: 実ファイルをSupabase Storageにアップロード
- **重複防止**: ファイル入力のクリア処理で重複アップロードを防止
- **ファイル名表示**: 長いファイル名にtruncateクラスを適用してレイアウト崩れを防止
- **外部キー制約**: uploaded_byカラムのNULL許可とUUID検証

### 試合記録管理の改善
- **ファイル削除**: ログアウトと同じデザインの確認ダイアログを実装
- **ボタンデザイン**: 閲覧・削除ボタンに背景色を追加して誤クリック防止
- **既存情報保持**: ファイルアップロード時に既存の試合記録情報を保持

### 参加進捗の改善
- **コメント表示**: ツールチップからモーダル形式に変更
- **シンプルデザイン**: 右上×ボタン、中央揃え選手名
- **グリッドレイアウト維持**: 長いコメントでもレイアウトが崩れない

## 🎉 過去のアップデート（v2.2）

### 会計管理システム統合
- **支出報告機能**: 保護者が立替金を報告（野球関連費目に特化）
- **立替金状況**: 全員の未払い立替金を透明性高く表示
- **支出管理**: 管理者が支出の承認・却下・支払い管理
- **立替金管理**: 立替金の集計・支払い処理
- **野球特化費目**: 部員・補食関連、備品・消耗品、遠征・交通費など8カテゴリ
- **よく使われる費目**: コーチお茶代、消耗品、大会参加費、懇親会費用のワンクリック選択
- **レシート画像**: 領収書の画像アップロード・表示機能

### UI/UX改善
- **ハンバーガーメニュー**: 下部ナビゲーションとハンバーガーメニューの使い分け
- **透明性向上**: 全員の未払い立替金を確認可能
- **直感的操作**: よく使われる費目の自動選択機能
- **統一アイコン**: 会計関連アイコンをBanknoteで統一

## 🎉 過去のアップデート（v2.1）

### Supabase連携
- クラウドデータベース（PostgreSQL）への移行
- リアルタイムデータ同期
- ファイルストレージ機能
- データの永続化とバックアップ

### 新機能追加
- **選手名簿**: 全選手の一覧表示（学年別グループ化）
- **学年別フィルタ**: 選手管理での学年別絞り込み
- **過去イベント非表示**: 未来のイベントのみ表示
- **参加状況ソート**: 参加状況による選手の並び替え

### UI/UX改善
- **試合記録UI**: シンプルで見やすい表示（アイコン削除、結果表示改善）
- **ログイン画面**: ロゴの影削除、不要文字削除、PIN案内の改行
- **フッタータブ**: アイコンと文字サイズの調整
- **エラーメッセージ**: 日本語化による理解しやすさの向上

### データ管理改善
- **練習イベント**: 自動的に参加扱い（不参加連絡のみ）
- **ファイル管理**: Supabaseでのファイル保存・表示
- **モックデータ**: 過去データの削除、クリーンな状態

### スマートフォンアプリ風UI
- モバイルファーストデザインでPCでもスマートフォンサイズ表示
- 固定下部ナビゲーションでアプリ風の操作感
- アコーディオン形式で詳細情報を展開・折りたたみ

### 機能改善
- 参加状況入力のアコーディオン化
- 進捗確認のモーダル表示
- 試合記録のアコーディオン表示
- 統一カラーパレット（青：肯定、赤：否定）
- ログアウト確認ダイアログ

### 管理者機能の独立化
- 進捗確認、試合記録、選手管理を独立ページ化
- 各機能への直接アクセスが可能
- より使いやすい管理者インターフェース
